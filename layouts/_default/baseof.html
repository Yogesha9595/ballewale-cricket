<!DOCTYPE html>
<html lang="en">
<head>
  {{ partial "head.html" . }}

  <!-- BalleWale custom stylesheet -->
  {{ $style := resources.Get "css/ballewale.css" | minify | fingerprint }}
  <link rel="stylesheet" href="{{ $style.RelPermalink }}">
</head>

<body>

  <!-- Top live score strip -->
  {{ partial "header-strip.html" . }}

  <!-- Main header -->
  {{ partial "header.html" . }}

  <main class="main">
    {{ block "main" . }}{{ end }}
  </main>

  <!-- Footer -->
  {{ partial "footer.html" . }}

  <!-- =========================
       LIVE SCORE SCRIPT
       FINAL PRODUCTION VERSION
  ========================= -->
  {{ if .IsHome }}
  <script>
  (function () {
    const API_URL = "https://ballewale-rss-ai.yogesha9595.workers.dev/api/live.json";
    const REFRESH_INTERVAL = 15000;

    function setText(id, value) {
      const el = document.getElementById(id);
      if (el) el.textContent = value;
    }

    function setFlag(id, code, alt) {
      const img = document.getElementById(id);
      if (!img || !code) return;
      img.src = "https://flagcdn.com/w40/" + code + ".png";
      img.alt = alt || "";
    }

    function showNoMatch() {
      setText("live-commentary", "No live matches right now");
    }

    function showOffline() {
      setText("live-commentary", "Live score temporarily unavailable");
    }

    async function loadLiveScore() {
      // Exit safely if scoreboard not on page
      const exists = document.getElementById("team1-name");
      if (!exists) return;

      try {
        const res = await fetch(API_URL, { cache: "no-store" });
        if (!res.ok) throw new Error("API error");

        const data = await res.json();
        if (!data.matches || data.matches.length === 0) {
          showNoMatch();
          return;
        }

        // Prefer India or Pakistan match
        let match = data.matches.find(m => {
          const teams = (m.team1 + " " + m.team2).toLowerCase();
          return teams.includes("india") || teams.includes("pakistan");
        });

        if (!match) match = data.matches[0];

        // Update scoreboard
        setText("team1-name", match.team1 || "TEAM A");
        setText("team1-score", match.score1 || "-");

        setText("team2-name", match.team2 || "TEAM B");
        setText("team2-score", match.score2 || "-");

        setText("match-status", match.status || "LIVE");
        setText("match-overs", match.overs || "");

        setFlag("team1-flag", match.flag1, match.team1);
        setFlag("team2-flag", match.flag2, match.team2);

        setText(
          "live-commentary",
          match.commentary || match.status || "Live match in progress"
        );

      } catch (err) {
        console.warn("Scoreboard fallback:", err);
        showOffline();
      }
    }

    // Initial load
    loadLiveScore();

    // Auto refresh
    setInterval(loadLiveScore, REFRESH_INTERVAL);
  })();
  </script>
  {{ end }}

</body>
</html>
