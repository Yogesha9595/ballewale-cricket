<!DOCTYPE html>
<html lang="en">
<head>
  {{ partial "head.html" . }}

  <!-- BalleWale custom stylesheet -->
  {{ $style := resources.Get "css/ballewale.css" | minify | fingerprint }}
  <link rel="stylesheet" href="{{ $style.RelPermalink }}">
</head>

<body>

  <!-- Top live score strip -->
  {{ partial "header-strip.html" . }}

  <!-- Main header -->
  {{ partial "header.html" . }}

  <main class="main">
    {{ block "main" . }}{{ end }}
  </main>

  <!-- Footer -->
  {{ partial "footer.html" . }}

  <!-- =========================
       LIVE SCORE SCRIPT
       (Production-safe version)
  ========================= -->
  {{ if .IsHome }}
  <script>
  async function loadLiveScore() {
    const team1Name = document.getElementById("team1-name");
    const team1Score = document.getElementById("team1-score");
    const team2Name = document.getElementById("team2-name");
    const team2Score = document.getElementById("team2-score");
    const matchStatus = document.getElementById("match-status");
    const matchOvers = document.getElementById("match-overs");
    const commentary = document.getElementById("live-commentary");

    // Exit if scoreboard not on page
    if (!team1Name || !team2Name) return;

    try {
      const res = await fetch(
        "https://ballewale-rss-ai.yogesha9595.workers.dev/api/live.json",
        { cache: "no-store" }
      );
      const data = await res.json();

      if (!data.matches || data.matches.length === 0) {
        if (commentary) {
          commentary.textContent = "No live matches right now";
        }
        return;
      }

      // Prefer India or Pakistan match if present
      let match = data.matches[0];
      const preferred = data.matches.find(m =>
        (m.team1 && m.team1.toLowerCase().includes("india")) ||
        (m.team2 && m.team2.toLowerCase().includes("india")) ||
        (m.team1 && m.team1.toLowerCase().includes("pakistan")) ||
        (m.team2 && m.team2.toLowerCase().includes("pakistan"))
      );
      if (preferred) match = preferred;

      team1Name.textContent = match.team1 || "TEAM A";
      team1Score.textContent = match.score1 || "-";

      team2Name.textContent = match.team2 || "TEAM B";
      team2Score.textContent = match.score2 || "-";

      if (matchStatus) {
        matchStatus.textContent = match.status || "LIVE";
      }

      if (matchOvers) {
        matchOvers.textContent = match.overs || "";
      }

      if (commentary) {
        commentary.textContent = match.status || "Live match in progress";
      }

    } catch (e) {
      if (commentary) {
        commentary.textContent = "Live score unavailable";
      }
    }
  }

  // Initial load
  loadLiveScore();

  // Refresh every 15 seconds
  setInterval(loadLiveScore, 15000);
  </script>
  {{ end }}

</body>
</html>
