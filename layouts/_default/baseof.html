<!DOCTYPE html>
<html lang="en">
<head>
  {{ partial "head.html" . }}

  <!-- BalleWale custom stylesheet -->
  {{ $style := resources.Get "css/ballewale.css" | minify | fingerprint }}
  <link rel="stylesheet" href="{{ $style.RelPermalink }}">
</head>

<body>

  <!-- Top live score strip -->
  {{ partial "header-strip.html" . }}

  <!-- Main header -->
  {{ partial "header.html" . }}

  <main class="main">
    {{ block "main" . }}{{ end }}
  </main>

  <!-- Footer -->
  {{ partial "footer.html" . }}

  <!-- =========================
       LIVE SCORE SCRIPT
       (Safe + production ready)
  ========================= -->
  {{ if .IsHome }}
  <script>
  async function loadLiveScore() {
    const team1Name = document.getElementById("team1-name");
    const team1Score = document.getElementById("team1-score");
    const team2Name = document.getElementById("team2-name");
    const team2Score = document.getElementById("team2-score");
    const matchStatus = document.getElementById("match-status");
    const matchOvers = document.getElementById("match-overs");
    const commentary = document.getElementById("live-commentary");
    const flag1 = document.getElementById("team1-flag");
    const flag2 = document.getElementById("team2-flag");

    // If homepage scoreboard not present, exit
    if (!team1Name || !team2Name) return;

    try {
      const res = await fetch("/api/live.json", { cache: "no-store" });
      const data = await res.json();

      if (!data.matches || data.matches.length === 0) {
        if (commentary) {
          commentary.textContent = "No live matches right now";
        }
        return;
      }

      const match = data.matches[0];

      if (team1Name) team1Name.textContent = match.team1 || "TEAM A";
      if (team1Score) team1Score.textContent = match.score1 || "-";

      if (team2Name) team2Name.textContent = match.team2 || "TEAM B";
      if (team2Score) team2Score.textContent = match.score2 || "-";

      if (matchStatus) matchStatus.textContent = match.status || "LIVE";
      if (matchOvers) matchOvers.textContent = match.overs || "";

      if (commentary && match.commentary) {
        commentary.textContent = match.commentary;
      }

      // Flags
      if (flag1 && match.flag1) {
        flag1.src = "https://flagcdn.com/w40/" + match.flag1 + ".png";
        flag1.alt = match.team1;
      }

      if (flag2 && match.flag2) {
        flag2.src = "https://flagcdn.com/w40/" + match.flag2 + ".png";
        flag2.alt = match.team2;
      }

    } catch (e) {
      if (commentary) {
        commentary.textContent = "Live score unavailable";
      }
    }
  }

  // Initial load
  loadLiveScore();

  // Refresh every 15 seconds for real-time feel
  setInterval(loadLiveScore, 15000);
  </script>
  {{ end }}

</body>
</html>
